(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d216435"],{c25e:function(e,t,n){"use strict";n.r(t);var a=n("7a23"),r=Object(a["withScopeId"])("data-v-8f7c10b0");Object(a["pushScopeId"])("data-v-8f7c10b0");var o={style:{width:"700px"}},c=Object(a["createTextVNode"])("主账号"),l=Object(a["createTextVNode"])("子账号"),u={style:{float:"left"}},i={style:{float:"right",color:"#8492a6","font-size":"13px"}},d=Object(a["createTextVNode"])("关联"),s=Object(a["createTextVNode"])("解绑"),b=Object(a["createTextVNode"])(" 确认 "),p={style:{width:"700px"}},f=Object(a["createTextVNode"])(" 确认 "),m={style:{width:"100%"}},O={style:{"text-align":"center","padding-bottom":"20px"}};Object(a["popScopeId"])();var j=r((function(e,t,n,j,v,g){var h=Object(a["resolveComponent"])("el-input"),V=Object(a["resolveComponent"])("el-form-item"),w=Object(a["resolveComponent"])("el-radio"),N=Object(a["resolveComponent"])("el-option"),y=Object(a["resolveComponent"])("el-select"),C=Object(a["resolveComponent"])("el-button"),k=Object(a["resolveComponent"])("el-table-column"),_=Object(a["resolveComponent"])("el-table"),F=Object(a["resolveComponent"])("hb-avatar-uploader"),U=Object(a["resolveComponent"])("el-form"),x=Object(a["resolveComponent"])("el-tab-pane"),I=Object(a["resolveComponent"])("el-tooltip"),S=Object(a["resolveComponent"])("el-pagination"),$=Object(a["resolveComponent"])("el-tabs"),T=Object(a["resolveComponent"])("hb-page-layout-full"),D=Object(a["resolveDirective"])("loading");return Object(a["openBlock"])(),Object(a["createBlock"])(T,null,{default:r((function(){return[Object(a["createVNode"])($,{modelValue:j.activeTab,"onUpdate:modelValue":t[10]||(t[10]=function(e){return j.activeTab=e})},{default:r((function(){return[Object(a["createVNode"])(x,{label:"个人信息",name:"userInfo"},{default:r((function(){return[Object(a["createVNode"])("div",o,[Object(a["createVNode"])(U,{ref:"userInfoForm",model:j.infoForm,rules:j.infoRules,"label-width":"80px",style:{padding:"20px"}},{default:r((function(){return[Object(a["createVNode"])(V,{label:"账号"},{default:r((function(){return[Object(a["createVNode"])(h,{modelValue:j.infoForm.username,"onUpdate:modelValue":t[1]||(t[1]=function(e){return j.infoForm.username=e}),disabled:!0},null,8,["modelValue"])]})),_:1}),Object(a["createVNode"])(V,{label:"姓名",prop:"nickname"},{default:r((function(){return[Object(a["createVNode"])(h,{modelValue:j.infoForm.nickname,"onUpdate:modelValue":t[2]||(t[2]=function(e){return j.infoForm.nickname=e})},null,8,["modelValue"])]})),_:1}),Object(a["createVNode"])(V,{label:"账号类型"},{default:r((function(){return[Object(a["createVNode"])(w,{modelValue:j.infoForm.userType,"onUpdate:modelValue":t[3]||(t[3]=function(e){return j.infoForm.userType=e}),label:"0",border:"",disabled:!0},{default:r((function(){return[c]})),_:1},8,["modelValue"]),Object(a["createVNode"])(w,{modelValue:j.infoForm.userType,"onUpdate:modelValue":t[4]||(t[4]=function(e){return j.infoForm.userType=e}),label:"1",border:"",disabled:!0},{default:r((function(){return[l]})),_:1},8,["modelValue"])]})),_:1}),Object(a["withDirectives"])(Object(a["createVNode"])(V,{label:"关联账号"},{default:r((function(){return[Object(a["createVNode"])(y,{modelValue:j.linkUser,"onUpdate:modelValue":t[5]||(t[5]=function(e){return j.linkUser=e}),filterable:"",remote:"","reserve-keyword":"",placeholder:"请输入账号","remote-method":j.remoteMethod,loading:j.selectLoading,clearable:""},{default:r((function(){return[(Object(a["openBlock"])(!0),Object(a["createBlock"])(a["Fragment"],null,Object(a["renderList"])(j.linkOptions,(function(e){return Object(a["openBlock"])(),Object(a["createBlock"])(N,{key:e.value,label:e.nickname,value:e.id},{default:r((function(){return[Object(a["createVNode"])("span",u,Object(a["toDisplayString"])(e.nickname),1),Object(a["createVNode"])("span",i,Object(a["toDisplayString"])(e.username),1)]})),_:2},1032,["label","value"])})),128))]})),_:1},8,["modelValue","remote-method","loading"]),Object(a["createVNode"])(C,{style:{"margin-left":"15px"},type:"primary",onClick:j.handleLink},{default:r((function(){return[d]})),_:1},8,["onClick"])]})),_:1},512),[[a["vShow"],"1"===j.infoForm.userType&&0===j.userLinkData.length]]),Object(a["createVNode"])(V,{label:"1"===j.infoForm.userType?"主账号":"子账号"},{default:r((function(){return[Object(a["createVNode"])(_,{data:j.infoForm.userlist,size:"mini",border:"",style:{width:"100%"}},{default:r((function(){return[Object(a["createVNode"])(k,{prop:"username",align:"center",label:"账号",width:"150"}),Object(a["createVNode"])(k,{prop:"nickname",align:"center",label:"姓名"}),Object(a["createVNode"])(k,{fixed:"right",align:"center",label:"操作"},{default:r((function(e){return[Object(a["createVNode"])(C,{onClick:function(t){return j.handleUnLink(e.row)},type:"danger",size:"small"},{default:r((function(){return[s]})),_:2},1032,["onClick"])]})),_:1})]})),_:1},8,["data"])]})),_:1},8,["label"]),Object(a["createVNode"])(V,{label:"头像"},{default:r((function(){return[Object(a["createVNode"])(F,{src:j.imgId2Url(j.infoForm.headPic),onCropped:j.onCropped},null,8,["src","onCropped"])]})),_:1}),Object(a["createVNode"])(V,null,{default:r((function(){return[Object(a["createVNode"])(C,{type:"primary",onClick:t[6]||(t[6]=function(e){return j.handleInfoSubmit("userInfoForm")})},{default:r((function(){return[b]})),_:1})]})),_:1})]})),_:1},8,["model","rules"])])]})),_:1}),Object(a["createVNode"])(x,{label:"修改密码",name:"editPassword"},{default:r((function(){return[Object(a["createVNode"])("div",p,[Object(a["createVNode"])(U,{ref:"userPasswordForm",model:j.passwordForm,rules:j.passwordRules,"label-width":"80px",style:{padding:"20px"}},{default:r((function(){return[Object(a["createVNode"])(V,{label:"密码",prop:"password"},{default:r((function(){return[Object(a["createVNode"])(h,{type:"password",modelValue:j.passwordForm.password,"onUpdate:modelValue":t[7]||(t[7]=function(e){return j.passwordForm.password=e})},null,8,["modelValue"])]})),_:1}),Object(a["createVNode"])(V,{label:"确认密码",prop:"passwordConfirm"},{default:r((function(){return[Object(a["createVNode"])(h,{type:"password",modelValue:j.passwordForm.passwordConfirm,"onUpdate:modelValue":t[8]||(t[8]=function(e){return j.passwordForm.passwordConfirm=e})},null,8,["modelValue"])]})),_:1}),Object(a["createVNode"])(V,null,{default:r((function(){return[Object(a["createVNode"])(C,{type:"primary",onClick:t[9]||(t[9]=function(e){return j.handlePasswordSubmit("userPasswordForm")})},{default:r((function(){return[f]})),_:1})]})),_:1})]})),_:1},8,["model","rules"])])]})),_:1}),Object(a["createVNode"])(x,{label:"安全日志",name:"securityLog"},{default:r((function(){return[Object(a["createVNode"])("div",m,[Object(a["withDirectives"])(Object(a["createVNode"])(_,{size:"mini",data:j.tableData.list,border:"",style:{width:"100%"}},{default:r((function(){return[Object(a["createVNode"])(k,{prop:"loginTime",align:"center",label:"登录时间",width:"210"}),Object(a["createVNode"])(k,{prop:"clientId",align:"center",label:"客户端id",width:"260"}),Object(a["createVNode"])(k,{prop:"platform",align:"center",label:"登录平台",width:"80"}),Object(a["createVNode"])(k,{prop:"ipAddress",align:"center",label:"地区",width:"230"}),Object(a["createVNode"])(k,{prop:"ip",align:"center",label:"登录ip",width:"200"}),Object(a["createVNode"])(k,{prop:"ua",align:"center",label:"UA信息","min-width":"200"},{default:r((function(e){return[Object(a["createVNode"])(I,{content:e.row.ua,placement:"top"},{default:r((function(){return[Object(a["createVNode"])("span",null,Object(a["toDisplayString"])(j.parseUA(e.row.ua)),1)]})),_:2},1032,["content"])]})),_:1})]})),_:1},8,["data"]),[[D,j.tableData.loading]]),Object(a["createVNode"])("div",O,[Object(a["createVNode"])(S,{"page-sizes":[20,50,100],"page-size":j.tableData.searchCondition.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:j.tableData.total,style:{margin:"15px 0"},onSizeChange:j.pageSizeChange,onCurrentChange:j.pageNoChange},null,8,["page-size","total","onSizeChange","onCurrentChange"])])])]})),_:1})]})),_:1},8,["modelValue"])]})),_:1})})),v=(n("d81d"),n("a434"),n("b0c0"),n("d3b7"),n("9ab4")),g=n("0fdc"),h=n("f3e7"),V=n("8f49"),w=n("2b80"),N=n.n(w),y={name:"index",components:{HbAvatarUploader:g["a"]},setup:function(){var e=this,t=Object(h["a"])(),n=Object(a["computed"])((function(){return t.$security.getUser().value.data})),r=Object(a["computed"])((function(){return t.$store.getters["userCenterActiveName"]})),o=Object(V["a"])({conditions:{userId:{default:n.value.id,reset:n.value.id}},dataAPI:t.$api.queryLoginHistory}),c=o.pageData,l=o.defaultDataLoader,u=o.pageNoChange,i=o.pageSizeChange,d=o.pageConditionSearch,s=o.defaultPageReset,b=function(e,t,n){""===t?n(new Error("请再次输入密码")):t!==O.value.password?n(new Error("两次输入密码不一致!")):n()},p=Object(a["ref"])(""),f=Object(a["ref"])({id:0,nickname:"",status:1,headPic:""}),m={nickname:[{required:!0,message:"请输入昵称",trigger:"change"}]},O=Object(a["ref"])({id:"",password:"",passwordConfirm:""}),j={password:[{required:!0,message:"请输入密码",trigger:"change"}],passwordConfirm:[{required:!0,validator:b,trigger:"blur"}]},g=Object(a["ref"])(!1),w=Object(a["ref"])(""),y=Object(a["ref"])([]),C=Object(a["ref"])([]),k=function(e){return t.$api.$imgId2Url(e)};Object(a["watch"])(p,(function(){"userInfo"===p.value&&x()})),Object(a["watch"])(r,(function(){p.value=r.value}));var _=function(e){var t=new N.a;t.setUA(e);var n=t.getResult(),a=n.os.name?n.os.name:"-",r=n.browser.name?n.browser.name:"-";return"操作系统："+a+" | 浏览器名称："+r},F=function(){return Object(v["b"])(e,void 0,void 0,(function(){var e,a;return Object(v["c"])(this,(function(r){switch(r.label){case 0:return[4,t.$api.userGet(n.value.id)];case 1:return e=r.sent(),0===e.code&&(a=t.$security.getUser(),a.value.data=e.data),[2]}}))}))},U=function(n){return Object(v["b"])(e,void 0,void 0,(function(){var e,a,r;return Object(v["c"])(this,(function(o){switch(o.label){case 0:return[4,new Promise((function(e){t.$refs[n].validate((function(t){e(t)}))}))];case 1:return e=o.sent(),e?(a=[],C.value.map((function(e){a.push(e.id)})),f.value.userIdList=a,[4,t.$api.userEdit(f.value)]):[2];case 2:return r=o.sent(),0!==r.code?[3,4]:(t.$notify({type:"success",title:"提示",message:"操作成功！"}),[4,F()]);case 3:return o.sent(),[3,5];case 4:t.$notify({type:"error",title:"提示",message:r.msg}),o.label=5;case 5:return[2]}}))}))},x=function(){return Object(v["b"])(e,void 0,void 0,(function(){var e;return Object(v["c"])(this,(function(a){switch(a.label){case 0:return[4,t.$api.userGet(n.value.id)];case 1:return e=a.sent(),0===e.code?(f.value=e.data,C.value=e.data.userlist):(w.value="",y.value=[],C.value=[]),[2]}}))}))},I=function(n){return Object(v["b"])(e,void 0,void 0,(function(){var e;return Object(v["c"])(this,(function(a){switch(a.label){case 0:return""===n?[3,2]:(g.value=!0,[4,t.$api.queryMainAccountList(n)]);case 1:return e=a.sent(),0===e.code&&(y.value=e.data),g.value=!1,[3,3];case 2:y.value=[],a.label=3;case 3:return[2]}}))}))},S=function(){y.value.map((function(e){e.id===w.value&&C.value.push({id:e.id,username:e.username,nickname:e.nickname})}))},$=function(e){for(var t=0,n=0;n<C.value.length;n++)e.id===C.value[n].id&&(t=n);C.value.splice(t,1)},T=function(n){return Object(v["b"])(e,void 0,void 0,(function(){var e,a;return Object(v["c"])(this,(function(r){switch(r.label){case 0:return[4,new Promise((function(e){n.toBlob((function(t){e(t)}))}))];case 1:return e=r.sent(),[4,t.$api.uploadImage(e)];case 2:return a=r.sent(),0===a.code?f.value.headPic=a.data:t.$notify({type:"error",title:"提示",message:a.msg}),[2]}}))}))},D=function(a){return Object(v["b"])(e,void 0,void 0,(function(){var e,r;return Object(v["c"])(this,(function(o){switch(o.label){case 0:return[4,new Promise((function(e){t.$refs[a].validate((function(t){e(t)}))}))];case 1:return e=o.sent(),e?(O.value.id=n.value.id,[4,t.$api.userPwd(O.value)]):[2];case 2:return r=o.sent(),0===r.code?(t.$notify({type:"success",title:"提示",message:"操作成功！"}),O.value.password="",O.value.passwordConfirm=""):t.$notify({type:"error",title:"提示",message:r.msg}),[2]}}))}))};return Object(a["onMounted"])((function(){p.value=r.value})),{imgId2Url:k,updateUserInfo:F,handleInfoSubmit:U,open:x,handleLink:S,remoteMethod:I,handleUnLink:$,onCropped:T,handlePasswordSubmit:D,parseUA:_,activeTab:p,infoForm:f,infoRules:m,passwordForm:O,passwordRules:j,selectLoading:g,linkUser:w,linkOptions:y,userLinkData:C,userInfo:n,activeName:r,tableData:c,handleSearch:l,pageNoChange:u,pageSizeChange:i,pageConditionSearch:d,handleReset:s}}};y.render=j,y.__scopeId="data-v-8f7c10b0";t["default"]=y}}]);